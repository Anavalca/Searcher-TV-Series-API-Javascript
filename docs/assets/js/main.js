"use strict";const searchInput=document.querySelector("#search_input"),searchButton=document.querySelector("#search_button");let ulTvSeries=document.querySelector("#series_list"),ulFav=document.querySelector("#favourites_list"),webLogo=document.querySelector("#title_container"),gifCoverPage=document.querySelector(".gif_container"),favouritesIcon=document.querySelector("#icon_fav"),tvSeries=[],favourites=[];function loadSeries(){fetch(`https://api.tvmaze.com/search/shows?q=${searchInput.value}`).then(e=>e.json()).then(e=>{if(tvSeries=e,showSeriesSearch(tvSeries),0==tvSeries.length){let e=document.createElement("p");e.classList.add("alert"),e.appendChild(document.createTextNode("No hay elementos para esa b√∫squeda")),ulTvSeries.appendChild(e)}})}function showSeriesSearch(e){removeChildren(gifCoverPage),removeChildren(ulTvSeries);for(let t of e){let e=!1,r=document.createElement("li");r.setAttribute("id","ele_"+t.show.id),r.classList.add("listSeries");let a=document.createElement("img");null===t.show.image?a.setAttribute("src","https://via.placeholder.com/210x295/ffffff/666666/?text=TV"):a.setAttribute("src",t.show.image.medium);let o,i=document.createElement("p");i.classList.add("main-title"),i.appendChild(document.createTextNode(t.show.name));for(let a of favourites)t.show.id===parseInt(a.id)&&(r.classList.add("favouritesMainStyle"),o=document.createElement("i"),o.classList.add("icon_fav"),o.classList.add("fas"),o.classList.add("fa-star"),e=!0);r.appendChild(a),r.appendChild(i),e&&r.appendChild(o),ulTvSeries.appendChild(r)}addClickListeners()}function addClickListeners(){const e=document.querySelectorAll("#series_list li");for(let t of e)t.addEventListener("click",saveFavourites)}function saveFavourites(e){let t=!1;for(let r of favourites){let a=e.currentTarget.id.substr(4);if(r.id===a){t=!0;break}}if(!1===t){setLocalStorage(e.currentTarget),renderFavourite(e.currentTarget),e.currentTarget.classList.add("favouritesMainStyle");let t=document.createElement("i");t.classList.add("icon_fav"),t.classList.add("fas"),t.classList.add("fa-star"),e.currentTarget.appendChild(t)}else removeFavouriteFromUl(e)}function renderFavourite(e){let t=e.cloneNode(!0);t.id=t.id.replace("ele","fav");let r=document.createElement("button");r.type="button",r.classList.add("deleteButton"),r.addEventListener("click",removeFavouriteFromButton),r.appendChild(document.createTextNode("x")),t.appendChild(r),ulFav.appendChild(t),changeStarFavoutitesIcon()}function setLocalStorage(e){let t=new Object;t.id=e.id.substr(4),t.imgSrc=e.childNodes[0].src,t.name=e.childNodes[1].textContent,favourites.push(t),localStorage.setItem("seriesFavInfo",JSON.stringify(favourites))}function readLocalStorage(){let e=JSON.parse(localStorage.getItem("seriesFavInfo"));if(null!==e)for(let t of e)favourites.push(t),renderFavouritesOfLocalStorage(t)}function renderFavouritesOfLocalStorage(e){let t=document.createElement("li");t.setAttribute("id","fav_"+e.id),t.classList.add("listSeries");let r=document.createElement("img");r.setAttribute("src",e.imgSrc);let a=document.createElement("p");a.classList.add("main-title"),a.appendChild(document.createTextNode(e.name));let o=document.createElement("button");o.type="button",o.classList.add("deleteButton"),o.appendChild(document.createTextNode("x")),o.addEventListener("click",removeFavouriteFromButton),t.appendChild(r),t.appendChild(a),t.appendChild(o),ulFav.appendChild(t),changeStarFavoutitesIcon()}function removeFavouriteFromId(e){let t=0;for(let r of favourites){if(r.id===e){favourites.splice(t,1),localStorage.setItem("seriesFavInfo",JSON.stringify(favourites));break}t++}document.querySelector("#fav_"+e).remove();let r=document.querySelector("#ele_"+e);null!==r&&(r.classList.remove("favouritesMainStyle"),r.lastChild.remove()),changeStarFavoutitesIcon()}function removeFavouriteFromButton(e){let t=e.currentTarget.parentElement.id;t=t.substr(4),removeFavouriteFromId(t)}function removeFavouriteFromUl(e){let t=e.currentTarget.id;t=t.substr(4),removeFavouriteFromId(t)}function restaureWeb(){searchInput.value="",removeChildren(ulTvSeries),appearCoverPage()}function appearCoverPage(){let e=document.createElement("img");e.setAttribute("src","./assets/images/tv.gif"),e.setAttribute("id","gif_tv"),e.setAttribute("title","Stay home"),e.setAttribute("alt","gif tv message:stay home"),removeChildren(gifCoverPage),gifCoverPage.appendChild(e)}function removeChildren(e){for(;e.firstChild;)e.removeChild(e.firstChild)}function deteleAllFavouties(){favourites=[],localStorage.setItem("seriesFavInfo",JSON.stringify(favourites)),removeChildren(ulFav);let e=document.querySelectorAll(".favouritesMainStyle");for(let t of e)t.classList.remove("favouritesMainStyle"),t.lastChild.remove();changeStarFavoutitesIcon()}function activeSearchWithEnter(e){13===e.keyCode&&loadSeries()}function changeStarFavoutitesIcon(){0===ulFav.childNodes.length?(favouritesIcon.classList.remove("fas"),favouritesIcon.classList.add("far")):(favouritesIcon.classList.remove("far"),favouritesIcon.classList.add("fas"))}function showAllFavourites(){for(let e of favourites)console.log(e.name)}appearCoverPage(),readLocalStorage(),searchButton.addEventListener("click",loadSeries),webLogo.addEventListener("click",restaureWeb),favouritesIcon.addEventListener("click",deteleAllFavouties),document.addEventListener("keydown",activeSearchWithEnter);